// SEED SCRIPT (Auto-generated by Antigravity)
// This script will clear (optional) and repopulate Habits and Classes/Rutinas based on the "Full Focus" schedule.

window.seedLifeSchedule = async function () {
    if (!confirm('âš ï¸ Â¿EstÃ¡s seguro? Esto crearÃ¡ todos tus hÃ¡bitos y rutinas en la base de datos. (No borrarÃ¡ lo existente, solo aÃ±adirÃ¡).')) return;

    // Intentar obtener usuario de window.currentUser o directamente de Supabase
    let userId = window.currentUser?.id;

    if (!userId) {
        console.log('ğŸ”„ Consultando sesiÃ³n de Supabase...');
        const { data: { user } } = await window.supabaseClient.auth.getUser();
        userId = user?.id;
    }

    if (!userId) {
        alert('âŒ Error: No se detecta la sesiÃ³n. AsegÃºrate de haber iniciado sesiÃ³n y recarga la pÃ¡gina.');
        return;
    }

    console.log('ğŸš€ Iniciando Seed... Usuario:', userId);
    let logs = [];
    const log = (msg) => { console.log(msg); logs.push(msg); };

    // 1. HÃBITOS DIARIOS (Daily Habits)
    const habits = [
        { title: 'â˜€ï¸ Despertar 8AM' },
        { title: 'ğŸ’ª Ejercicio 8AM' },
        { title: 'ğŸš¿ BaÃ±arse 8:30AM' },
        { title: 'ğŸ³ Desayuno 9AM' },
        { title: 'ğŸ‘¨â€ğŸ’» Code Focus 9:30AM' },
        { title: 'ğŸ’ OFFSZN Build 10:30AM' },
        { title: 'ğŸ¬ Ordenar Guiones 12PM' },
        { title: 'ğŸ‡ºğŸ‡¸ InglÃ©s Practice 1PM' },
        { title: 'ğŸ“– Lectura 2PM' },
        { title: 'ğŸ½ï¸ Comida 2:30PM' },
        { title: 'ğŸ“± Admin Mode 7PM' },
        { title: 'ğŸ¥— Cena 8PM' },
        { title: 'ğŸ§  ReflexiÃ³n Nocturna' },
        { title: 'ğŸ˜´ Dormir 10:30PM' }
    ];

    log('ğŸŒ± Creando hÃ¡bitos...');
    for (const habit of habits) {
        const { error } = await window.supabaseClient
            .from('habits')
            .insert([{
                title: habit.title,
                completed_dates: [],
                user_id: userId,
                created_at: new Date().toISOString()
            }]);

        if (error) log(`âŒ Error hÃ¡bito ${habit.title}: ${error.message}`);
        else log(`âœ… HÃ¡bito creado: ${habit.title}`);
    }

    // 2. CLASES / BLOQUES FIJOS (Usaremos la tabla 'classes' para bloques de tiempo fijos)
    // Lunes = 1, Martes = 2... Domingo = 7? No, usually Lunes-Viernes checkboxes.
    // 'classes' table structure based on app.js: subject, day, startTime, endTime, room(optional)

    const scheduleBlocks = [
        // L-M-V InglÃ©s
        { subject: 'ğŸ‡ºğŸ‡¸ English Class', day: 'Lunes', startTime: '16:00', endTime: '19:00', room: 'Academia' },
        { subject: 'ğŸ‡ºğŸ‡¸ English Class', day: 'MiÃ©rcoles', startTime: '16:00', endTime: '19:00', room: 'Academia' },
        { subject: 'ğŸ‡ºğŸ‡¸ English Class', day: 'Viernes', startTime: '16:00', endTime: '19:00', room: 'Academia' },

        // M-J Deep Work
        { subject: 'ğŸš€ DEEP WORK OFFSZN', day: 'Martes', startTime: '15:30', endTime: '19:00', room: 'Home' },
        { subject: 'ğŸš€ DEEP WORK OFFSZN', day: 'Jueves', startTime: '15:30', endTime: '19:00', room: 'Home' },

        // S-D EdiciÃ³n
        { subject: 'ğŸ¥ FULL EDICIÃ“N', day: 'SÃ¡bado', startTime: '15:30', endTime: '20:00', room: 'Studio' },
        { subject: 'ğŸ¥ FULL EDICIÃ“N', day: 'Domingo', startTime: '15:30', endTime: '20:00', room: 'Studio' },

        // Noches OFFSZN (L-M-V-S-D)
        { subject: 'ğŸŒ OFFSZN Web', day: 'Lunes', startTime: '20:30', endTime: '21:30', room: 'Home' },
        { subject: 'ğŸŒ OFFSZN Web', day: 'MiÃ©rcoles', startTime: '20:30', endTime: '21:30', room: 'Home' },
        { subject: 'ğŸŒ OFFSZN Web', day: 'Viernes', startTime: '20:30', endTime: '21:30', room: 'Home' },
        { subject: 'ğŸ’ OFFSZN Code', day: 'SÃ¡bado', startTime: '20:30', endTime: '21:30', room: 'Home' },
        { subject: 'ğŸ’ OFFSZN Code', day: 'Domingo', startTime: '20:30', endTime: '21:30', room: 'Home' },

        // Noches Assets (M-J)
        { subject: 'âœï¸ Guiones & Assets', day: 'Martes', startTime: '20:30', endTime: '21:30', room: 'Home' },
        { subject: 'âœï¸ Guiones & Assets', day: 'Jueves', startTime: '20:30', endTime: '21:30', room: 'Home' },
    ];

    log('ğŸ“… Agendando bloques semanales...');
    for (const block of scheduleBlocks) {
        const { error } = await window.supabaseClient
            .from('classes')
            .insert([{
                subject: block.subject,
                day: block.day,
                startTime: block.startTime,
                endTime: block.endTime,
                room: block.room,
                user_id: userId,
                created_at: new Date().toISOString()
            }]);

        if (error) log(`âŒ Error bloque ${block.day} ${block.subject}: ${error.message}`);
        else log(`âœ… Bloque creado: ${block.day} - ${block.subject}`);
    }

    alert('âœ¨ Â¡Proceso terminado! Revisa la consola para detalles.');
    window.location.reload(); // Recargar para ver cambios
};
